# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã‚¬ã‚¤ãƒ‰

## ğŸ“‹ æº–å‚™å®Œäº†

Phase 1ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã€RLSã€ãƒˆãƒªã‚¬ãƒ¼ãŒæº–å‚™ã§ãã¾ã—ãŸã€‚
ä»¥ä¸‹ã®æ‰‹é †ã§Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ã—ã¾ã™ã€‚

## ğŸš€ å®Ÿè¡Œæ–¹æ³•: Supabase Dashboardï¼ˆæ¨å¥¨ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—1: SQL Editorã‚’é–‹ã

ä»¥ä¸‹ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„:
```
https://supabase.com/dashboard/project/jhqnypyxrkwdrgutzttf/sql
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³SQLã‚’ã‚³ãƒ”ãƒ¼

`supabase/migrations/all_migrations.sql` ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’å…¨ã¦ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚

ã¾ãŸã¯ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼:
```bash
# macOS
cat supabase/migrations/all_migrations.sql | pbcopy

# ã¾ãŸã¯æ‰‹å‹•ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
open supabase/migrations/all_migrations.sql
```

### ã‚¹ãƒ†ãƒƒãƒ—3: SQL Editorã«è²¼ã‚Šä»˜ã‘ã¦å®Ÿè¡Œ

1. Supabase Dashboardã®SQL Editorã«è²¼ã‚Šä»˜ã‘
2. å³ä¸‹ã® **ã€ŒRunã€** ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. å®Ÿè¡Œå®Œäº†ã‚’å¾…ã¤ï¼ˆæ•°ç§’ã§å®Œäº†ã—ã¾ã™ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—4: å®Ÿè¡Œçµæœã‚’ç¢ºèª

æˆåŠŸã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™:
- Extensions enabled
- Tables created
- Triggers created
- RLS enabled
- Policies created

## ğŸ“Š å®Ÿè¡Œå†…å®¹ã®è©³ç´°

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³001: æ‹¡å¼µæ©Ÿèƒ½
- âœ… `uuid-ossp` - UUIDç”Ÿæˆ
- âœ… `postgis` - åœ°ç†ç©ºé–“ãƒ‡ãƒ¼ã‚¿

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³002: ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- âœ… `profiles` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
- âœ… `regions` - åœ°åŸŸãƒã‚¹ã‚¿ (808åœ°åŸŸ)
- âœ… `parking_spots` - é§è»Šå ´æƒ…å ±
- âœ… `restaurants` - ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³æƒ…å ±
- âœ… `likes` - ã„ã„ã­çµ±åˆãƒ†ãƒ¼ãƒ–ãƒ«
- âœ… `comments` - ã‚³ãƒ¡ãƒ³ãƒˆ

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³003: ãƒˆãƒªã‚¬ãƒ¼
- âœ… ã„ã„ã­æ•°è‡ªå‹•æ›´æ–°
- âœ… ã‚³ãƒ¡ãƒ³ãƒˆæ•°è‡ªå‹•æ›´æ–°
- âœ… Realtime Broadcastçµ±åˆ

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³004: RLS
- âœ… ã™ã¹ã¦ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§RLSæœ‰åŠ¹åŒ–
- âœ… èªè¨¼ãƒ»åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œãƒãƒªã‚·ãƒ¼
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

## ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå¾Œã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã™ã‚‹å ´åˆ:

1. Supabase Dashboardã®SQL Editorã§æ–°ã—ã„ã‚¯ã‚¨ãƒªã‚’é–‹ã
2. `supabase/seed.sql` ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆ
3. å®Ÿè¡Œ

ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã«ã¯ä»¥ä¸‹ãŒå«ã¾ã‚Œã¾ã™:
- 3åœ°åŸŸï¼ˆã‚ãŠã°é€šã€ä»™å°é§…ã€äº¬éƒ½é§…ï¼‰
- 3é§è»Šå ´
- 3ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³

## âœ… ç¢ºèªæ–¹æ³•

### 1. ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚ŒãŸã‹ç¢ºèª

Supabase Dashboard â†’ Database â†’ Tables ã§ä»¥ä¸‹ã‚’ç¢ºèª:
- âœ… profiles
- âœ… regions
- âœ… parking_spots
- âœ… restaurants
- âœ… likes
- âœ… comments

### 2. RLSãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

å„ãƒ†ãƒ¼ãƒ–ãƒ«ã®å³å´ã« **ğŸ”’ RLS enabled** ãƒãƒ¼ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### 3. ãƒãƒªã‚·ãƒ¼ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

å„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ **Policies** ã‚¿ãƒ–ã§ä»¥ä¸‹ã‚’ç¢ºèª:
- âœ… profiles: 2ãƒãƒªã‚·ãƒ¼
- âœ… regions: 1ãƒãƒªã‚·ãƒ¼
- âœ… parking_spots: 1ãƒãƒªã‚·ãƒ¼
- âœ… restaurants: 1ãƒãƒªã‚·ãƒ¼
- âœ… likes: 4ãƒãƒªã‚·ãƒ¼
- âœ… comments: 4ãƒãƒªã‚·ãƒ¼

### 4. ãƒˆãƒªã‚¬ãƒ¼ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

Supabase Dashboard â†’ Database â†’ Functions ã§ä»¥ä¸‹ã‚’ç¢ºèª:
- âœ… handle_updated_at()
- âœ… handle_new_user()
- âœ… update_like_count()
- âœ… update_comment_count()
- âœ… broadcast_like_changes()
- âœ… broadcast_comment_changes()

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "extension ... already exists"

**åŸå› **: æ‹¡å¼µæ©Ÿèƒ½ãŒæ—¢ã«æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹
**å¯¾å‡¦**: å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚æ¬¡ã«é€²ã‚“ã§ãã ã•ã„ã€‚

### ã‚¨ãƒ©ãƒ¼: "relation ... already exists"

**åŸå› **: ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹
**å¯¾å‡¦**: æ—¢å­˜ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤ã™ã‚‹ã‹ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚­ãƒƒãƒ—

æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤ã™ã‚‹å ´åˆ:
```sql
-- è­¦å‘Š: ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™
drop table if exists public.comments cascade;
drop table if exists public.likes cascade;
drop table if exists public.restaurants cascade;
drop table if exists public.parking_spots cascade;
drop table if exists public.regions cascade;
drop table if exists public.profiles cascade;
```

### ã‚¨ãƒ©ãƒ¼: "permission denied"

**åŸå› **: å®Ÿè¡Œæ¨©é™ãŒãªã„
**å¯¾å‡¦**: Supabase Dashboardã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç®¡ç†è€…æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹ç¢ºèª

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ãŸã‚‰:

1. âœ… **Phase 1å®Œäº†**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŸºç›¤æ§‹ç¯‰
2. â¡ï¸ **Phase 2é–‹å§‹**: èªè¨¼ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰
   - Google OAuthè¨­å®š
   - èªè¨¼UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
   - FingerprintJSçµ±åˆ

è©³ç´°ã¯ `IMPLEMENTATION_SCHEME.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:
1. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒ”ãƒ¼
2. `PHASE1_COMPLETE.md`ã®æ¤œè¨¼é …ç›®ã‚’ç¢ºèª
3. å¿…è¦ã«å¿œã˜ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†å®Ÿè¡Œ

---

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: camping-spot-publisher
**Phase**: 1 - Database Foundation
**Last Updated**: 2025-10-25
