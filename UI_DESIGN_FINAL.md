# ã„ã„ã­æ©Ÿèƒ½ UIè¨­è¨ˆæ›¸ï¼ˆæœ€çµ‚ç‰ˆ - æ—¢å­˜ãƒ‡ã‚¶ã‚¤ãƒ³å®Œå…¨æµç”¨ï¼‰

## 1. æ¦‚è¦

æ—¢å­˜ã®2ç¨®é¡ã®ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’**å®Œå…¨ã«æµç”¨**ã—ã€ã„ã„ã­ãƒœã‚¿ãƒ³ã¨ã„ã„ã­æ•°ã®ã¿ã‚’è¿½åŠ ã—ã¾ã™ã€‚

### å¯¾è±¡ã‚«ãƒ¼ãƒ‰
1. **ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰** - ã‚ªãƒ¬ãƒ³ã‚¸ã‚¹ãƒˆãƒ©ã‚¤ãƒ— + ãƒ™ãƒ¼ã‚¸ãƒ¥èƒŒæ™¯
2. **é§è»Šå ´ã‚«ãƒ¼ãƒ‰** - æ°´è‰²èƒŒæ™¯ + é‡‘ãƒ¡ãƒ€ãƒ«

---

## 2. é§è»Šå ´ã‚«ãƒ¼ãƒ‰ã®ã„ã„ã­æ©Ÿèƒ½è¿½åŠ 

### 2.1 ç¾åœ¨ã®ãƒ‡ã‚¶ã‚¤ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¥‡ 1ä½: åé‰„å”å•†å¤§é˜ªæŸé‡Œï¼‘ä¸ç›®      [ğŸ—ºï¸] [ğŸ”]      â”‚
â”‚                                                      â”‚
â”‚ ğŸ“ å¾’æ­©ç´„4åˆ†ï¼ˆ284mï¼‰  â”‚  ğŸª ã‚³ãƒ³ãƒ“ãƒ‹ï¼ˆ153mï¼‰      â”‚
â”‚                                                      â”‚
â”‚ ğŸ’° Â¥500ï¼ˆ18:00-8:00ï¼‰  â”‚  ğŸ”¥ undefinedï¼ˆ0.4kmï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹å¾´:**
- æ°´è‰²ï¼ˆ#E3F2FDï¼‰ã®èƒŒæ™¯
- å·¦å´ã«é‡‘ãƒ¡ãƒ€ãƒ«ğŸ¥‡ã‚¢ã‚¤ã‚³ãƒ³
- å³ä¸Šã«åœ°å›³ãƒ»æ¤œç´¢ãƒœã‚¿ãƒ³
- é§è»Šå ´åã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
- å¾’æ­©æ™‚é–“ã€ã‚³ãƒ³ãƒ“ãƒ‹ã€æ–™é‡‘ã€æ¸©æ³‰æƒ…å ±

### 2.2 ã„ã„ã­è¿½åŠ å¾Œã®ãƒ‡ã‚¶ã‚¤ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¥‡ 1ä½: åé‰„å”å•†å¤§é˜ªæŸé‡Œï¼‘ä¸ç›®  [â¤ï¸ 12] [ğŸ—ºï¸] [ğŸ”] â”‚
â”‚                                                      â”‚
â”‚ ğŸ“ å¾’æ­©ç´„4åˆ†ï¼ˆ284mï¼‰  â”‚  ğŸª ã‚³ãƒ³ãƒ“ãƒ‹ï¼ˆ153mï¼‰      â”‚
â”‚                                                      â”‚
â”‚ ğŸ’° Â¥500ï¼ˆ18:00-8:00ï¼‰  â”‚  ğŸ”¥ undefinedï¼ˆ0.4kmï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¿½åŠ å†…å®¹:**
- å³ä¸Šãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã«ã„ã„ã­ãƒœã‚¿ãƒ³è¿½åŠ ï¼ˆåœ°å›³ãƒ»æ¤œç´¢ã®å·¦ï¼‰
- ãƒœã‚¿ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ã¯æ—¢å­˜ãƒœã‚¿ãƒ³ã¨çµ±ä¸€
- ã„ã„ã­æ•°ã‚’è¡¨ç¤º

---

## 3. ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ã®ã„ã„ã­æ©Ÿèƒ½è¿½åŠ 

### 3.1 ç¾åœ¨ã®ãƒ‡ã‚¶ã‚¤ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1                                     â”‚
â”‚                                       â”‚
â”‚ é†¤æ²¹ã¨è²ã¨éºº ãã—ã¦äººã¨å¤¢            â”‚
â”‚                                       â”‚
â”‚ [ãƒ©ãƒ¼ãƒ¡ãƒ³]                            â”‚
â”‚                                       â”‚
â”‚ ğŸ“ å¤§é˜ªåºœå¤§é˜ªå¸‚è¥¿æ·€å·åŒºæŸé‡Œ3-12-22    â”‚
â”‚                                       â”‚
â”‚ [ğŸ—ºï¸ åœ°å›³] [ğŸ” æ¤œç´¢]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹å¾´:**
- ã‚ªãƒ¬ãƒ³ã‚¸ï¼ˆ#FF8C00ï¼‰ã®å·¦å´ã‚¹ãƒˆãƒ©ã‚¤ãƒ—
- ãƒ™ãƒ¼ã‚¸ãƒ¥ï¼ˆ#FFF8DCï¼‰ã®èƒŒæ™¯
- å·¦ä¸Šã«ç•ªå·è¡¨ç¤º
- ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³åãƒ»ã‚¸ãƒ£ãƒ³ãƒ«ãƒ»ä½æ‰€
- ä¸‹éƒ¨ã«åœ°å›³ãƒ»æ¤œç´¢ãƒœã‚¿ãƒ³

### 3.2 ã„ã„ã­è¿½åŠ å¾Œã®ãƒ‡ã‚¶ã‚¤ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1                        [â¤ï¸ 24]      â”‚
â”‚                                       â”‚
â”‚ é†¤æ²¹ã¨è²ã¨éºº ãã—ã¦äººã¨å¤¢            â”‚
â”‚                                       â”‚
â”‚ [ãƒ©ãƒ¼ãƒ¡ãƒ³]                            â”‚
â”‚                                       â”‚
â”‚ ğŸ“ å¤§é˜ªåºœå¤§é˜ªå¸‚è¥¿æ·€å·åŒºæŸé‡Œ3-12-22    â”‚
â”‚                                       â”‚
â”‚ [ğŸ—ºï¸ åœ°å›³] [ğŸ” æ¤œç´¢]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¿½åŠ å†…å®¹:**
- å³ä¸Šã«ã„ã„ã­ãƒœã‚¿ãƒ³é…ç½®ï¼ˆç•ªå·ã®åå¯¾å´ï¼‰
- ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªãƒœã‚¿ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³

---

## 4. HTMLå®Ÿè£…

### 4.1 é§è»Šå ´ã‚«ãƒ¼ãƒ‰ï¼ˆå®Œå…¨ç‰ˆï¼‰

```html
<div class="parking-spot-card" data-parking-id="uuid-parking-123">
  <div class="parking-header">
    <div class="parking-title">
      <span class="ranking-icon">ğŸ¥‡</span>
      <span class="ranking-text">1ä½:</span>
      <span class="parking-name">åé‰„å”å•†å¤§é˜ªæŸé‡Œï¼‘ä¸ç›®</span>
    </div>

    <div class="card-buttons">
      <!-- ã„ã„ã­ãƒœã‚¿ãƒ³ï¼ˆæ–°è¦è¿½åŠ ï¼‰ -->
      <button class="btn-like" onclick="toggleParkingLike('uuid-parking-123')" aria-label="ã„ã„ã­">
        <svg class="heart-icon" viewBox="0 0 24 24" width="20" height="20">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
        <span class="like-count">12</span>
      </button>

      <!-- æ—¢å­˜ãƒœã‚¿ãƒ³ -->
      <button class="btn-map" onclick="openMap(event, 34.7110, 135.4968)">
        ğŸ—ºï¸
      </button>
      <button class="btn-search" onclick="searchLocation(event, 'åé‰„å”å•†å¤§é˜ªæŸé‡Œï¼‘ä¸ç›®')">
        ğŸ”
      </button>
    </div>
  </div>

  <div class="parking-info">
    <div class="info-row">
      <div class="info-item">
        <span class="info-icon">ğŸ“</span>
        <span class="info-text">å¾’æ­©ç´„4åˆ†ï¼ˆ284mï¼‰</span>
      </div>
      <div class="info-divider">|</div>
      <div class="info-item">
        <span class="info-icon">ğŸª</span>
        <span class="info-text">ã‚³ãƒ³ãƒ“ãƒ‹ï¼ˆ153mï¼‰</span>
      </div>
    </div>

    <div class="info-row">
      <div class="info-item">
        <span class="info-icon">ğŸ’°</span>
        <span class="info-text fee-highlight">Â¥500ï¼ˆ18:00-8:00ï¼‰</span>
      </div>
      <div class="info-divider">|</div>
      <div class="info-item">
        <span class="info-icon">ğŸ”¥</span>
        <span class="info-text">undefinedï¼ˆ0.4kmï¼‰</span>
      </div>
    </div>
  </div>
</div>
```

### 4.2 ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ï¼ˆå®Œå…¨ç‰ˆï¼‰

```html
<div class="restaurant-card" data-restaurant-id="uuid-rest-456">
  <div class="card-stripe"></div>

  <div class="card-content">
    <div class="card-header">
      <span class="card-number">1</span>

      <!-- ã„ã„ã­ãƒœã‚¿ãƒ³ï¼ˆæ–°è¦è¿½åŠ ï¼‰ -->
      <button class="btn-like-compact" onclick="toggleRestaurantLike('uuid-rest-456')" aria-label="ã„ã„ã­">
        <svg class="heart-icon" viewBox="0 0 24 24" width="20" height="20">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
        <span class="like-count">24</span>
      </button>
    </div>

    <h3 class="restaurant-name">é†¤æ²¹ã¨è²ã¨éºº ãã—ã¦äººã¨å¤¢</h3>

    <div class="restaurant-genre">
      <span class="genre-tag">ãƒ©ãƒ¼ãƒ¡ãƒ³</span>
    </div>

    <p class="restaurant-address">
      ğŸ“ å¤§é˜ªåºœå¤§é˜ªå¸‚è¥¿æ·€å·åŒºæŸé‡Œ3-12-22
    </p>

    <div class="card-actions">
      <button class="btn-map" onclick="openMap(event, 34.7110, 135.4968)">
        ğŸ—ºï¸ åœ°å›³
      </button>
      <button class="btn-search" onclick="searchLocation(event, 'é†¤æ²¹ã¨è²ã¨éºº ãã—ã¦äººã¨å¤¢')">
        ğŸ” æ¤œç´¢
      </button>
    </div>
  </div>
</div>
```

---

## 5. CSSå®Ÿè£…

### 5.1 é§è»Šå ´ã‚«ãƒ¼ãƒ‰ï¼ˆæ—¢å­˜ã‚¹ã‚¿ã‚¤ãƒ«ç¶­æŒï¼‰

```css
/* é§è»Šå ´ã‚«ãƒ¼ãƒ‰åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
.parking-spot-card {
  background: #E3F2FD; /* æ°´è‰² */
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ† */
.parking-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.parking-title {
  display: flex;
  align-items: center;
  gap: 6px;
  flex: 1;
}

.ranking-icon {
  font-size: 1.5em;
}

.ranking-text {
  font-weight: 600;
  color: #1976d2;
}

.parking-name {
  font-weight: 600;
  color: #333;
  font-size: 1.1em;
}

/* ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ— */
.card-buttons {
  display: flex;
  gap: 8px;
  align-items: center;
}

/* æ—¢å­˜ã®åœ°å›³ãƒ»æ¤œç´¢ãƒœã‚¿ãƒ³ */
.btn-map,
.btn-search {
  width: 48px;
  height: 48px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1.5em;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s, box-shadow 0.2s;
}

.btn-map {
  background: #4285f4; /* é’ */
}

.btn-search {
  background: #00bcd4; /* ã‚·ã‚¢ãƒ³ */
}

.btn-map:hover,
.btn-search:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.btn-map:active,
.btn-search:active {
  transform: translateY(0);
}

/* ã„ã„ã­ãƒœã‚¿ãƒ³ï¼ˆé§è»Šå ´ã‚«ãƒ¼ãƒ‰ç”¨ï¼‰ */
.btn-like {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 10px 14px;
  background: white;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-like:hover {
  background: #fff3f3;
  border-color: #e74c3c;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.btn-like:active {
  transform: translateY(0);
}

/* ã„ã„ã­æ¸ˆã¿çŠ¶æ…‹ */
.btn-like.liked {
  background: #ffebee;
  border-color: #e74c3c;
}

/* ãƒãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ */
.heart-icon {
  fill: #ccc;
  transition: fill 0.3s;
}

.heart-icon.liked {
  fill: #e74c3c;
  animation: heartbeat 0.4s ease-in-out;
}

@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  25% { transform: scale(1.3); }
  50% { transform: scale(1.1); }
  75% { transform: scale(1.2); }
}

/* ã„ã„ã­æ•° */
.like-count {
  font-size: 14px;
  font-weight: 600;
  color: #666;
  min-width: 16px;
}

.btn-like.liked .like-count {
  color: #e74c3c;
}

/* é§è»Šå ´æƒ…å ±ã‚¨ãƒªã‚¢ */
.parking-info {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.info-row {
  display: flex;
  align-items: center;
  gap: 12px;
}

.info-item {
  display: flex;
  align-items: center;
  gap: 6px;
}

.info-icon {
  font-size: 1.1em;
}

.info-text {
  font-size: 0.95em;
  color: #555;
}

.fee-highlight {
  color: #d32f2f;
  font-weight: 600;
  font-size: 1.05em;
}

.info-divider {
  color: #bbb;
  font-weight: 300;
}
```

### 5.2 ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ï¼ˆæ—¢å­˜ã‚¹ã‚¿ã‚¤ãƒ«ç¶­æŒï¼‰

```css
/* ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
.restaurant-card {
  position: relative;
  background: #FFF8DC; /* ãƒ™ãƒ¼ã‚¸ãƒ¥ */
  border-radius: 8px;
  margin-bottom: 20px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

/* ã‚ªãƒ¬ãƒ³ã‚¸ã‚¹ãƒˆãƒ©ã‚¤ãƒ— */
.card-stripe {
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 6px;
  background: #FF8C00;
}

.card-content {
  margin-left: 10px;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆç•ªå· + ã„ã„ã­ãƒœã‚¿ãƒ³ï¼‰ */
.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.card-number {
  font-size: 2em;
  font-weight: bold;
  color: #FF8C00;
  line-height: 1;
}

/* ã„ã„ã­ãƒœã‚¿ãƒ³ï¼ˆãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ç”¨ãƒ»ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰ */
.btn-like-compact {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 6px 10px;
  background: white;
  border: 2px solid #e0e0e0;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-like-compact:hover {
  background: #fff3f3;
  border-color: #e74c3c;
  transform: scale(1.05);
}

.btn-like-compact:active {
  transform: scale(0.95);
}

.btn-like-compact.liked {
  background: #ffebee;
  border-color: #e74c3c;
}

/* ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³å */
.restaurant-name {
  font-size: 1.3em;
  font-weight: bold;
  color: #333;
  margin: 0 0 12px 0;
  line-height: 1.4;
}

/* ã‚¸ãƒ£ãƒ³ãƒ«ã‚¿ã‚° */
.restaurant-genre {
  margin-bottom: 12px;
}

.genre-tag {
  display: inline-block;
  background: #FF8C00;
  color: white;
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 0.9em;
  font-weight: 500;
}

/* ä½æ‰€ */
.restaurant-address {
  font-size: 0.95em;
  color: #666;
  margin: 8px 0 16px 0;
  line-height: 1.5;
}

/* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
.card-actions {
  display: flex;
  gap: 10px;
}

.card-actions .btn-map,
.card-actions .btn-search {
  flex: 1;
  padding: 10px 16px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9em;
  font-weight: 500;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  transition: all 0.2s;
}

.card-actions .btn-map {
  background: #4285f4;
}

.card-actions .btn-search {
  background: #34a853;
}

.card-actions .btn-map:hover,
.card-actions .btn-search:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}
```

---

## 6. JavaScriptå®Ÿè£…

### 6.1 ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆåˆæœŸåŒ–

```javascript
// likes.js

// Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
const supabase = window.supabase.createClient(
  'YOUR_SUPABASE_URL',
  'YOUR_SUPABASE_ANON_KEY'
);

// ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
let currentUser = null;
let userFingerprint = null;

// ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆåˆæœŸåŒ–
async function initFingerprint() {
  const fp = await FingerprintJS.load();
  const result = await fp.get();
  userFingerprint = result.visitorId;
}

// èªè¨¼çŠ¶æ…‹ç¢ºèª
async function checkAuth() {
  const { data: { session } } = await supabase.auth.getSession();
  if (session) {
    currentUser = session.user;
  }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
document.addEventListener('DOMContentLoaded', async () => {
  await initFingerprint();
  await checkAuth();
  await loadAllLikeStates();
});
```

### 6.2 ã„ã„ã­æ©Ÿèƒ½å®Ÿè£…

```javascript
// é§è»Šå ´ã¸ã®ã„ã„ã­åˆ‡ã‚Šæ›¿ãˆ
async function toggleParkingLike(parkingId) {
  const card = document.querySelector(`[data-parking-id="${parkingId}"]`);
  const likeBtn = card.querySelector('.btn-like');
  const heartIcon = likeBtn.querySelector('.heart-icon');
  const likeCount = likeBtn.querySelector('.like-count');
  const isLiked = heartIcon.classList.contains('liked');

  try {
    if (isLiked) {
      // ã„ã„ã­å‰Šé™¤
      await supabase
        .from('likes')
        .delete()
        .eq('target_type', 'parking_spot')
        .eq('target_id', parkingId)
        .eq(currentUser ? 'user_id' : 'user_fingerprint',
            currentUser ? currentUser.id : userFingerprint);

      heartIcon.classList.remove('liked');
      likeBtn.classList.remove('liked');
    } else {
      // ã„ã„ã­è¿½åŠ 
      await supabase
        .from('likes')
        .insert({
          target_type: 'parking_spot',
          target_id: parkingId,
          user_id: currentUser?.id || null,
          user_fingerprint: currentUser ? null : userFingerprint,
          ip_address: null // ã‚µãƒ¼ãƒãƒ¼å´ã§è¨­å®š
        });

      heartIcon.classList.add('liked');
      likeBtn.classList.add('liked');
    }

    // ã„ã„ã­æ•°ã‚’å†å–å¾—
    const { data: count } = await supabase
      .rpc('get_likes_count', {
        target_type_param: 'parking_spot',
        target_id_param: parkingId
      });

    likeCount.textContent = count || 0;

  } catch (error) {
    console.error('ã„ã„ã­ã‚¨ãƒ©ãƒ¼:', error);
    alert('ã„ã„ã­ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
  }
}

// ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¸ã®ã„ã„ã­åˆ‡ã‚Šæ›¿ãˆ
async function toggleRestaurantLike(restaurantId) {
  const card = document.querySelector(`[data-restaurant-id="${restaurantId}"]`);
  const likeBtn = card.querySelector('.btn-like-compact');
  const heartIcon = likeBtn.querySelector('.heart-icon');
  const likeCount = likeBtn.querySelector('.like-count');
  const isLiked = heartIcon.classList.contains('liked');

  try {
    if (isLiked) {
      // ã„ã„ã­å‰Šé™¤
      await supabase
        .from('likes')
        .delete()
        .eq('target_type', 'restaurant')
        .eq('target_id', restaurantId)
        .eq(currentUser ? 'user_id' : 'user_fingerprint',
            currentUser ? currentUser.id : userFingerprint);

      heartIcon.classList.remove('liked');
      likeBtn.classList.remove('liked');
    } else {
      // ã„ã„ã­è¿½åŠ 
      await supabase
        .from('likes')
        .insert({
          target_type: 'restaurant',
          target_id: restaurantId,
          user_id: currentUser?.id || null,
          user_fingerprint: currentUser ? null : userFingerprint,
          ip_address: null
        });

      heartIcon.classList.add('liked');
      likeBtn.classList.add('liked');
    }

    // ã„ã„ã­æ•°ã‚’å†å–å¾—
    const { data: count } = await supabase
      .rpc('get_likes_count', {
        target_type_param: 'restaurant',
        target_id_param: restaurantId
      });

    likeCount.textContent = count || 0;

  } catch (error) {
    console.error('ã„ã„ã­ã‚¨ãƒ©ãƒ¼:', error);
    alert('ã„ã„ã­ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
  }
}
```

### 6.3 ã„ã„ã­çŠ¶æ…‹ã®èª­ã¿è¾¼ã¿

```javascript
// å…¨ã‚«ãƒ¼ãƒ‰ã®ã„ã„ã­çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã¿
async function loadAllLikeStates() {
  // é§è»Šå ´ã‚«ãƒ¼ãƒ‰ã®ã„ã„ã­çŠ¶æ…‹
  const parkingCards = document.querySelectorAll('.parking-spot-card');
  for (const card of parkingCards) {
    const parkingId = card.dataset.parkingId;
    await loadLikeState('parking_spot', parkingId, card);
  }

  // ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ã®ã„ã„ã­çŠ¶æ…‹
  const restaurantCards = document.querySelectorAll('.restaurant-card');
  for (const card of restaurantCards) {
    const restaurantId = card.dataset.restaurantId;
    await loadLikeState('restaurant', restaurantId, card);
  }
}

// å€‹åˆ¥ã®ã„ã„ã­çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã¿
async function loadLikeState(targetType, targetId, cardElement) {
  try {
    // ã„ã„ã­æ•°ã‚’å–å¾—
    const { data: count } = await supabase
      .rpc('get_likes_count', {
        target_type_param: targetType,
        target_id_param: targetId
      });

    const likeCountElement = cardElement.querySelector('.like-count');
    if (likeCountElement) {
      likeCountElement.textContent = count || 0;
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¢ã«ã„ã„ã­æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
    const { data: liked } = await supabase
      .rpc('check_user_liked', {
        target_type_param: targetType,
        target_id_param: targetId,
        user_id_param: currentUser?.id || null,
        fingerprint_param: userFingerprint
      });

    if (liked) {
      const heartIcon = cardElement.querySelector('.heart-icon');
      const likeBtn = cardElement.querySelector('.btn-like, .btn-like-compact');

      if (heartIcon) heartIcon.classList.add('liked');
      if (likeBtn) likeBtn.classList.add('liked');
    }
  } catch (error) {
    console.error('ã„ã„ã­çŠ¶æ…‹ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
  }
}
```

---

## 7. ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³

### 7.1 ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼ˆ768pxä»¥ä¸‹ï¼‰

```css
@media (max-width: 768px) {
  /* é§è»Šå ´ã‚«ãƒ¼ãƒ‰ */
  .parking-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .parking-title {
    width: 100%;
  }

  .card-buttons {
    width: 100%;
    justify-content: flex-end;
  }

  /* ã„ã„ã­ãƒœã‚¿ãƒ³ã‚’å°‘ã—å°ã•ã */
  .btn-like {
    padding: 8px 12px;
  }

  .heart-icon {
    width: 18px;
    height: 18px;
  }

  .like-count {
    font-size: 13px;
  }

  /* åœ°å›³ãƒ»æ¤œç´¢ãƒœã‚¿ãƒ³ */
  .btn-map,
  .btn-search {
    width: 44px;
    height: 44px;
    font-size: 1.3em;
  }

  /* ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ */
  .card-number {
    font-size: 1.5em;
  }

  .restaurant-name {
    font-size: 1.1em;
  }

  .card-actions {
    flex-direction: column;
  }

  .card-actions .btn-map,
  .card-actions .btn-search {
    width: 100%;
  }
}
```

---

## 8. æ—¢å­˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¸ã®çµ±åˆ

### 8.1 generate-from-json-sources.js ã®ä¿®æ­£ç®‡æ‰€

```javascript
// é§è»Šå ´ã‚«ãƒ¼ãƒ‰ç”Ÿæˆé–¢æ•°ã‚’ä¿®æ­£
function generateParkingCard(parking, index) {
  return `
    <div class="parking-spot-card" data-parking-id="${parking.id}">
      <div class="parking-header">
        <div class="parking-title">
          <span class="ranking-icon">${getRankingIcon(index + 1)}</span>
          <span class="ranking-text">${index + 1}ä½:</span>
          <span class="parking-name">${escapeHtml(parking.name)}</span>
        </div>

        <div class="card-buttons">
          <!-- ã„ã„ã­ãƒœã‚¿ãƒ³ï¼ˆæ–°è¦è¿½åŠ ï¼‰ -->
          <button class="btn-like" onclick="toggleParkingLike('${parking.id}')" aria-label="ã„ã„ã­">
            <svg class="heart-icon" viewBox="0 0 24 24" width="20" height="20">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
            <span class="like-count">0</span>
          </button>

          <!-- æ—¢å­˜ãƒœã‚¿ãƒ³ -->
          <button class="btn-map" onclick="openMap(event, ${parking.latitude}, ${parking.longitude})">
            ğŸ—ºï¸
          </button>
          <button class="btn-search" onclick="searchLocation(event, '${escapeHtml(parking.name)}')">
            ğŸ”
          </button>
        </div>
      </div>

      <div class="parking-info">
        <div class="info-row">
          <div class="info-item">
            <span class="info-icon">ğŸ“</span>
            <span class="info-text">å¾’æ­©ç´„${parking.walkingMinutes || '?'}åˆ†ï¼ˆ${parking.walkingDistance || '?'}mï¼‰</span>
          </div>
          <div class="info-divider">|</div>
          <div class="info-item">
            <span class="info-icon">ğŸª</span>
            <span class="info-text">ã‚³ãƒ³ãƒ“ãƒ‹ï¼ˆ${parking.convenienceDistance || '?'}mï¼‰</span>
          </div>
        </div>

        <div class="info-row">
          <div class="info-item">
            <span class="info-icon">ğŸ’°</span>
            <span class="info-text fee-highlight">Â¥${parking.overnight_fee || '---'}ï¼ˆ18:00-8:00ï¼‰</span>
          </div>
          <div class="info-divider">|</div>
          <div class="info-item">
            <span class="info-icon">ğŸ”¥</span>
            <span class="info-text">${parking.hotSpringName || 'undefined'}ï¼ˆ${parking.hotSpringDistance || '?'}kmï¼‰</span>
          </div>
        </div>
      </div>
    </div>
  `;
}

// ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰ç”Ÿæˆé–¢æ•°ã‚’ä¿®æ­£
function generateRestaurantCard(restaurant, index) {
  return `
    <div class="restaurant-card" data-restaurant-id="${restaurant.id}">
      <div class="card-stripe"></div>
      <div class="card-content">
        <div class="card-header">
          <span class="card-number">${index + 1}</span>

          <!-- ã„ã„ã­ãƒœã‚¿ãƒ³ï¼ˆæ–°è¦è¿½åŠ ï¼‰ -->
          <button class="btn-like-compact" onclick="toggleRestaurantLike('${restaurant.id}')" aria-label="ã„ã„ã­">
            <svg class="heart-icon" viewBox="0 0 24 24" width="20" height="20">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
            <span class="like-count">0</span>
          </button>
        </div>

        <h3 class="restaurant-name">${escapeHtml(restaurant.name)}</h3>

        <div class="restaurant-genre">
          <span class="genre-tag">${escapeHtml(restaurant.genre)}</span>
        </div>

        <p class="restaurant-address">
          ğŸ“ ${escapeHtml(restaurant.address)}
        </p>

        <div class="card-actions">
          <button class="btn-map" onclick="openMap(event, ${restaurant.latitude}, ${restaurant.longitude})">
            ğŸ—ºï¸ åœ°å›³
          </button>
          <button class="btn-search" onclick="searchLocation(event, '${escapeHtml(restaurant.name)}')">
            ğŸ” æ¤œç´¢
          </button>
        </div>
      </div>
    </div>
  `;
}

// ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¢ã‚¤ã‚³ãƒ³å–å¾—
function getRankingIcon(rank) {
  switch (rank) {
    case 1: return 'ğŸ¥‡';
    case 2: return 'ğŸ¥ˆ';
    case 3: return 'ğŸ¥‰';
    default: return `${rank}`;
  }
}
```

### 8.2 HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¸ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ 

```javascript
const htmlTemplate = `
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${regionName}ã®è»Šä¸­æ³Šã‚¹ãƒãƒƒãƒˆ</title>

  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- FingerprintJS -->
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>

  <style>
    ${allStyles}
    ${likeButtonStyles}
  </style>
</head>
<body>
  ${bodyContent}

  <script>
    // SupabaseåˆæœŸåŒ–
    const supabase = window.supabase.createClient(
      '${process.env.SUPABASE_URL}',
      '${process.env.SUPABASE_ANON_KEY}'
    );

    ${likeButtonScript}
  </script>
</body>
</html>
`;
```

---

## 9. ã¾ã¨ã‚

### âœ… å®Ÿè£…å†…å®¹

1. **é§è»Šå ´ã‚«ãƒ¼ãƒ‰**
   - æ°´è‰²èƒŒæ™¯ã®ãƒ‡ã‚¶ã‚¤ãƒ³å®Œå…¨ç¶­æŒ
   - é‡‘ãƒ¡ãƒ€ãƒ«ğŸ¥‡ã‚¢ã‚¤ã‚³ãƒ³ç¶­æŒ
   - å³ä¸Šã®ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã«ã„ã„ã­ãƒœã‚¿ãƒ³è¿½åŠ 
   - ã„ã„ã­æ•°è¡¨ç¤º

2. **ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚«ãƒ¼ãƒ‰**
   - ã‚ªãƒ¬ãƒ³ã‚¸ã‚¹ãƒˆãƒ©ã‚¤ãƒ— + ãƒ™ãƒ¼ã‚¸ãƒ¥èƒŒæ™¯ç¶­æŒ
   - ç•ªå·è¡¨ç¤ºç¶­æŒ
   - å³ä¸Šã«ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªã„ã„ã­ãƒœã‚¿ãƒ³è¿½åŠ 
   - ã„ã„ã­æ•°è¡¨ç¤º

3. **ã„ã„ã­æ©Ÿèƒ½**
   - èª°ã§ã‚‚ã„ã„ã­å¯èƒ½ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ä¸è¦ï¼‰
   - ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆèªè¨¼
   - Supabaseã§ãƒ‡ãƒ¼ã‚¿ç®¡ç†
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°

### ğŸ“Š å¤‰æ›´ç®‡æ‰€

- `generate-from-json-sources.js` - ã‚«ãƒ¼ãƒ‰ç”Ÿæˆé–¢æ•°ä¿®æ­£
- HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ - CSS/JSè¿½åŠ 
- æ—¢å­˜ãƒ‡ã‚¶ã‚¤ãƒ³ - **å¤‰æ›´ãªã—**

### ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
3. ç’°å¢ƒå¤‰æ•°è¨­å®š
4. generate-from-json-sources.jsä¿®æ­£
5. 808ç®‡æ‰€ã®åœ°åŸŸãƒšãƒ¼ã‚¸å†ç”Ÿæˆ

ã“ã®è¨­è¨ˆã§å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ

